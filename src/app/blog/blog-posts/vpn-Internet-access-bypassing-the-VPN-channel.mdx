---
title: 'Доступ в Internet минуя VPN канал'
author: 'Роберт'
publishDate: '29.11.24'
group: 'Vpn'
---

# Доступ в Internet минуя VPN канал

Требуется, чтобы рабочий трафик ходил внутри VPN канала, а остальной — шел обычным путем.

У нас имеется настроенное VPN соединение (VPN активен). Подключим его и проверим параметры интерфейсов. Для этого запустим командную строку (здесь и далее, командная строка должна быть с правами администратора).

Выполним команду **_ipconfig_**

![img1](/images/blog-img/vpn/1.png)

нас интересуют текущий IP-адрес локальной машины (**_192.168.0.164_**) и IP-адрес адаптера VPN соединения (**_192.168.112.45_**).

Проверим и убедимся, что у нас доступен интернет и трафик идет через VPN канал.

Для этого выполним **_ping 8.8.8.8_** до общедоступного DNS и **_tracert 8.8.8.8_**

![img1](/images/blog-img/vpn/2.png)

Как видно, интернет есть, и он идет через IP VPN соединения по сети **_192.168.112.0_**

Убедимся, что рабочий ресурс нам доступен, для этого выполним **_ping 192.168.1.100_** (это контроллер домена рабочей сети), а также **_tracert 192.168.1.100_**

![img1](/images/blog-img/vpn/3.png)

Ресурс доступен.

Для решения нашей задачи необходимо настроить *интерфейс VPN*: *Свойства VPN* -> *Свойства TCP/IPv4* -> *Дополнительно…* ->снять чек *«Использовать основной шлюз в удаленной сети»*

![img1](/images/blog-img/vpn/4.png)

Так как соединение было активно, требуется отключить и снова включить соединение, для вступления изменений в силу, о чем нас любезно предупредят.

Теперь весь трафик, который раньше шел через VPN – будет идти так, как было бы без него. Проведем эксперимент, для этого вновь проверим доступность интернета и как идет трафик

![img1](/images/blog-img/vpn/5.png)

Как видно из тестов, интернет идет через нужный нам канал, но доступ до рабочих ресурсов пропал. Нам необходимо явно добавить маршрут (маршруты), для которых необходим доступ по VPN.

Нам понадобится IP адрес шлюза VPN соединения или IP адрес, назначаемый при VPN подключении, если шлюз не известен. Для нашего примера это адрес **_192.168.112.45_**.

Посмотрим таблицу маршрутизации введя **_route print_**

![img1](/images/blog-img/vpn/6.png)

таблица маршрутизации

Нас интересует номер VPN интерфейса (подсвечен). Обратите внимание, что у нас отсутствуют постоянные маршруты.

Далее нам необходимо определить адрес(а) или подсеть трафик в которую необходимо направлять через VPN соединение. В нашем случае это весь трафик для рабочей сети *192.168.1.0/24*., который необходимо направлять через интерфейс VPN соединения **_192.168.112.45_**.

Пропишем постоянный маршрут:**_route add 192.168.1.0 mask 255.255.255.0 192.168.112.45 if 36 -p_**

Здесь, параметр **_-p_** означает, что добавляемый маршрут будет сохранён (_persistent_). Параметр **_if 36_** означает, что этот маршрут будет применяться только при поднятом интерфейсе 36 (т.е. при подключенном VPN, который имеет этот номер). Если не указать параметр *if*, то маршрут будет работать только до отключения VPN-соединения. При отключении, Windows определит, что маршрут более неприменим, и удалит его. После повторного подключения VPN, маршрут не будет активным несмотря на то, что он создан с параметром *-p*. Если указан параметр **_if_**, то при отключении от VPN система определит, что маршрут не следует удалять, и временно отключит его до поднятия нужного интерфейса.**_192.168.1.0_** — имя сети (или IP адрес) в которую мы обращаемся,**_mask 255.255.255.0_** — определяет маску сети или конкретный адрес,**_192.168.122.45_** — адрес шлюза или интерфейса, через который должен направляться трафик.

![img1](/images/blog-img/vpn/7.png)

Задача решена, проверим что все работает так как задумывалось.

Доступ до рабочих ресурсов есть и идет внутри VPN.

Подобный подход можно использовать и для настройки одновременной работе двух (или больше) сетевых карт.
