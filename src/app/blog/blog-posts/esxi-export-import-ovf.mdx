---
title: 'ESXi 7 — экспорт и импорт виртуальной машины через OVF шаблон'
author: 'Роберт'
publishDate: '17.07.25'
group: 'esxi'
---

# ESXi 7 — экспорт и импорт виртуальной машины через OVF шаблон

---

[Исходная инструкция](https://internet-lab.ru/esxi7_ovf_export_import)

## Подготовка к экспорту OVF

Перед тем как приступить непосредственное к экспорту, нужно подготовиться.

Удалите снапшоты виртуальной машины, это уменьшит размер экспортируемых файлов. Убедитесь, что на вашем диске достаточно свободного места. Скорее всего размер скачиваемых файлов будет меньше выделенного места под виртуальную машину, но узнать это можно опытным путём. Исходя из размера виртуальной машины, пропускной способности сети и скорости дисков выделите время на простой.

Если вы собираетесь сохранять данные не на системный диск, настройте в браузере директорию по умолчанию для хранения скачанных файлов. Убедитесь что в браузере разрешены всплывающие окна.

Отключите антивирусы и лишние программы, нагружающие ваш компьютер.

Процесс экспорта может быть долгим. В ESXi 7 сессия пользователя автоматически завершается, если он не был активен в ней более 15 минут, отключите этот механизм. Выберите свою учетную запись в правом верхнем углу веб-интерфейса → Settings → Application timeout. Отключите (off).

![img1](/images/blog-img/esxi/img1.jpg)

Извлеките подключённые образы CD-дисков или дискет.

Выключите виртуальную машину.

## Экспорт OVF шаблона

Правой кнопкой на виртуальную машину, Export.

![img2](/images/blog-img/esxi/img2.jpg)

Выберите файлы для экспорта, по умолчанию выбираются необходимые файлы. Файл NVRAM хранит настройки BIOS, если вы их меняли, выделите его тоже, я не буду его скачивать, что позже привнесёт в нашу операцию некоторые трудности, которые мы с успехом преодолеем. Export.

![img3](/images/blog-img/esxi/img3.jpg)

Каждый файл будет скачиваться отдельно.

Самый большой по объёму файл VMDK, это диск виртуальной машины. Дисков может быть несколько.

MF файл хранит хэш-суммы дисков.

![img4](/images/blog-img/esxi/img4.jpg)

OVF — это конфигурационный файл виртуальной машины в формате XML, в котором описывается её структура.

![img5](/images/blog-img/esxi/img5.jpg)

Экспорт OVF шаблона выполнен.

## Импорт OVF шаблона

Теперь выполним обратную операцию, импортируем OVF шаблон и сделаем виртуальную машину уже с другим именем.

Процесс импорта может быть долгим. В ESXi 7 сессия пользователя автоматически завершается, если он не был активен в ней более 15 минут, отключите этот механизм. Выберите свою учетную запись в правом верхнем углу веб-интерфейса → Settings → Application timeout. Отключите (off).

Переходим к хосту → Actions → Create/Register VM.

Выбираем Deploy a virtual machine from an OVF or OVA file. Next.

![img6](/images/blog-img/esxi/img6.jpg)

Указываем новое имя виртуальной машины. Кликаем на поле Click to select files or drag/drop.

Выбираем все файлы, которые мы ранее экспортировали. Открыть.

Список отобразился не полный, потому как из MF файла нужна только хэш-сумма. Next.

![img7](/images/blog-img/esxi/img7.jpg)

Выбираем хранилище.

Выбираем сеть, тип диска Thin или Thick, выбираем, включать ли виртуальную машину после импорта.

Thick provision lazy zeroed — толстый ленивый (по умолчанию). При создании занимает выделенный объём, но нулями не заполняет сразу, а по мере записи. Быстро создаёт большие винты, но потом тратит ресурсы на заполнение блоков нулями. При долгой работе в итоге превращается в жадный.
Thick provision eager zeroed — толстый жадный. При создании заполняет выделенный объём нулями. Долго создаёт большие винты, зато потом летает.
Thin provision — тонкий. Быстро создаётся, не занимает места на диске. По мере наполнения отжирает винт пока не заполнит весь выделенный для него объём. На это тратятся некоторые ресурсы. Опасен тем, что в один прекрасный момент места может не хватить, тогда с фризом нужно будет бороться танцами и бубном.

Next.

А теперь внимание — ошибка!

`A required disk image was missing`

Не хватает какого-то диска. Или мы забыли отмонтировать ISO образ CD-ROM, или забыли про файл NVRAM, что правда. Вернее, мы его и не скачивали. Отменяем операцию, Cancel.

![img8](/images/blog-img/esxi/img8.jpg)

Редактируем OVF файл. Действительно, в зависимостях есть mpsec.nvram (file2 ), который мы не скачивали. Стираем эту зависимость из XML, файл автоматически создастся при первом запуске.

![img9](/images/blog-img/esxi/img9.jpg)

Ещё второе упоминание есть, тоже стираем. Сохраняем конфиг.

![img10](/images/blog-img/esxi/img10.jpg)

Повторяем операцию импорта. На этот раз ошибки нет. Finish.

Начинается импорт файлов.

Дожидаемся завершения операции.

Появилась новая виртуальная машина.

Отключаю на новой виртуальной машине сеть и проверяю, виртуальная машина загружается.

Импорт OVF шаблона выполнен.

## Примечания

После экспорта OVF шаблона было бы неплохо проверить, что мы всё правильно скачали. Для этого нужно сверить хэш-суммы. У меня есть отдельная утилита, вы можете воспользоваться ей, или использовать аналоги, или не сверять хэш-сумму:

[Хеш-суммы в контекстном меню Windows (MD2, MD4, MD5, SHA1, SHA256, SHA384, SHA512)](https://internet-lab.ru/internet-lab_hash)

Если мы импортируем OVF шаблон на гипервизор другой версии, то может так произойти (а так обычно и происходит), что виртуальная машина не создаётся, отсутствуют указанные в конфигурационном файле устройства. В этом случае мы можем создать виртуальную машину вручную и в качестве дисков добавить экспортированные VMDK файлы, предварительно загрузив их в хранилище.

Или можно просто создать виртуальную машину, удалить у неё диск по умолчанию, загрузить в папку новой виртуальной машины на хранилище VMDK файл, добавить его в качестве диска в настройках виртуальной машины.

![img11](/images/blog-img/esxi/img11.jpg)

Перед импортом и экспортом боевых машин потренируйтесь на чём-нибудь менее важном. Не храните виртуальную машину на одном диске, используйте RAID. Не удаляйте резервные копии до полной реанимации системы.
